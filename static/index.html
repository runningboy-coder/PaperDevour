<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 研究助理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html, body {
            height: 100%;
            overflow: hidden; /* 防止頁面滾動 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
        }
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px;}
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* 列表項目選中狀態 */
        .article-item.active {
            background-color: #e2e8f0; /* Slate 200 */
            border-right-color: #3b82f6; /* Blue 500 */
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- 頁面頭部 -->
    <header class="bg-white border-b border-slate-200 flex-shrink-0">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-900"><path d="M12 22h6a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M5.43 12.57a1.5 1.5 0 0 0-2.12-.14l-1.17 1.17a1.5 1.5 0 0 0 0 2.12l1.17 1.17a1.5 1.5 0 0 0 2.12 0l1.17-1.17a1.5 1.5 0 0 0 0-2.12Z"/><path d="m12 18-2.5-2.5"/><path d="m8.5 18 3.5-3.5"/></svg>
                <h1 class="text-xl font-bold text-slate-900">AI 研究助理</h1>
            </div>
        </div>
    </header>

    <!-- 主內容區域 -->
    <div class="flex-grow flex overflow-hidden">
        <!-- 左側文章列表 -->
        <aside id="article-list-panel" class="w-1/3 xl:w-1/4 bg-white border-r border-slate-200 flex flex-col">
            <div class="p-4 border-b border-slate-200 flex-shrink-0">
                <h2 class="font-semibold text-lg">已收集文章</h2>
            </div>
            <div id="loading-list" class="flex items-center justify-center h-full">
                <p class="text-slate-500">正在加載文章列表...</p>
            </div>
            <ul id="article-list" class="overflow-y-auto flex-grow">
                <!-- 文章列表項將通過 JS 動態插入 -->
            </ul>
        </aside>

        <!-- 右側詳細內容 -->
        <main id="detail-panel" class="w-2/3 xl:w-3/4 bg-slate-50 overflow-y-auto p-6 sm:p-8">
            <div id="detail-placeholder" class="flex items-center justify-center h-full">
                <div class="text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-slate-400 mb-4"><path d="m12 3-9 9 9 9 9-9Z"/><path d="M3 12h18"/><path d="m12 3 9 9-9 9-9-9Z"/></svg>
                    <p class="text-slate-500">請從左側列表選擇一篇文章以查看詳細分析</p>
                </div>
            </div>
            <div id="detail-content" class="hidden">
                <!-- 文章詳細內容將通過 JS 動態插入 -->
            </div>
        </main>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const articleList = document.getElementById('article-list');
            const loadingList = document.getElementById('loading-list');
            const detailPlaceholder = document.getElementById('detail-placeholder');
            const detailContent = document.getElementById('detail-content');
            
            let articlesData = []; // 儲存所有文章數據

            // 函數：生成星星評分
            function renderStars(rating) {
                let stars = '';
                const filledStar = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-amber-400"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
                const emptyStar = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-slate-300"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
                for (let i = 1; i <= 5; i++) { stars += i <= rating ? filledStar : emptyStar; }
                return stars;
            }

            // 函數：顯示指定文章的詳細內容
            function displayArticleDetails(articleId) {
                const article = articlesData.find(a => a.id === articleId);
                if (!article) return;

                const aiAnalysis = article.ai_analysis || {};
                const keywords = aiAnalysis.keywords_en || [];
                const rating = aiAnalysis.innovation_rating || 0;

                detailContent.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <p class="text-sm text-slate-500 mb-2">${article.published}</p>
                        <h1 class="text-2xl md:text-3xl font-bold text-slate-900 mb-2">${article.title}</h1>
                        <p class="text-slate-600 mb-6">${article.authors.join(', ')}</p>
                        
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                            <h2 class="text-xl font-semibold text-slate-800 mb-4">AI 智能分析</h2>
                            <div class="space-y-6">
                                <div>
                                    <h3 class="font-semibold text-blue-800 mb-2">提煉摘要</h3>
                                    <p class="text-slate-700 leading-relaxed">${aiAnalysis.simplified_summary_zh || '無'}</p>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-slate-600 mb-2">核心關鍵詞</h3>
                                    <div class="flex flex-wrap gap-2">
                                        ${keywords.map(kw => `<span class="bg-slate-200 text-slate-700 text-xs font-medium px-2.5 py-1 rounded-full">${kw}</span>`).join('') || '<span class="text-slate-400 text-sm">無</span>'}
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <h3 class="font-semibold text-slate-600 mr-3">創新性評分</h3>
                                    <div class="flex items-center space-x-0.5">${renderStars(rating)}</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <a href="${article.pdf_url}" target="_blank" class="inline-flex items-center justify-center bg-blue-600 text-white font-semibold px-5 py-2.5 rounded-md hover:bg-blue-700 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10.4 12.6a2 2 0 1 1 3 3L8 21l-4 1 1-4Z"/><path d="M18 12.6a2 2 0 0 0-3-3L6 19l-1.5 1.5a2.828 2.828 0 1 0 4 4L18 12.6Z"/></svg>
                                閱讀原文 (PDF)
                            </a>
                        </div>
                    </div>
                `;
                detailPlaceholder.classList.add('hidden');
                detailContent.classList.remove('hidden');

                // 更新左側列表的選中狀態
                document.querySelectorAll('.article-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.id === articleId);
                });
            }

            // API URL, 請確保端口號與您的後端服務一致
            const apiUrl = 'http://127.0.0.1:5006/api/summaries';

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(articles => {
                    loadingList.style.display = 'none';
                    articlesData = articles;

                    if (articlesData.length === 0) {
                        articleList.innerHTML = '<li class="p-4 text-center text-slate-500">資料庫中沒有文章。</li>';
                        return;
                    }
                    
                    articlesData.forEach(article => {
                        const li = document.createElement('li');
                        li.className = 'article-item p-4 border-b border-r-4 border-transparent cursor-pointer hover:bg-slate-100';
                        li.dataset.id = article.id;
                        
                        const aiAnalysis = article.ai_analysis || {};
                        const keywords = (aiAnalysis.keywords_en || []).slice(0, 2);

                        li.innerHTML = `
                            <h3 class="font-semibold text-slate-800 truncate">${article.title}</h3>
                            <p class="text-sm text-slate-500 mt-1">${article.published}</p>
                            <div class="flex flex-wrap gap-1 mt-2">
                                ${keywords.map(kw => `<span class="bg-slate-200 text-slate-600 text-xs px-2 py-0.5 rounded">${kw}</span>`).join('')}
                            </div>
                        `;
                        
                        li.addEventListener('click', () => displayArticleDetails(article.id));
                        articleList.appendChild(li);
                    });

                    // 默認顯示第一篇文章的詳細內容
                    if (articlesData.length > 0) {
                        displayArticleDetails(articlesData[0].id);
                    }
                })
                .catch(error => {
                    console.error('獲取文章數據時出錯:', error);
                    loadingList.innerHTML = '<p class="text-red-600 p-4 text-center">加載失敗，請檢查後端服務。</p>';
                });
        });
    </script>

</body>
</html>