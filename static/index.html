<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 研究伙伴</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #cbd5e1;} /* bg-slate-900, text-slate-300 */
        /* 自定义深色滚动条 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; } /* bg-slate-800 */
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px;} /* bg-slate-600 */
        ::-webkit-scrollbar-thumb:hover { background: #64748b; } /* bg-slate-500 */
        
        .article-item.active { background-color: #1e293b; border-right-color: #38bdf8; } /* bg-slate-800, border-sky-400 */
        .tab.active { border-bottom-color: #38bdf8; color: #38bdf8; }
        .modal-content { max-height: 80vh; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="bg-slate-800/70 backdrop-blur-sm border-b border-slate-700 flex-shrink-0 z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M16.89 15.54c.34-.34.34-.89 0-1.23l-1.88-1.88a.87.87 0 0 0-1.23 0l-1.88 1.88a.87.87 0 0 0 0 1.23l1.88 1.88c.34.34.89.34 1.23 0zM12 14.12l1.29-1.29a.87.87 0 0 0 0-1.23L12 10.31l-1.29 1.29a.87.87 0 0 0 0 1.23zm-1.54-5.63c.34-.34.89-.34 1.23 0l1.88 1.88a.87.87 0 0 0 1.23 0l1.88-1.88a.87.87 0 0 0 0-1.23l-1.88-1.88a.87.87 0 0 0-1.23 0L12 7.12l-1.29-1.29a.87.87 0 0 0-1.23 0l-1.88 1.88a.87.87 0 0 0 0 1.23l1.88 1.88c.34.34.89.34 1.23 0zm-5.63 1.54c.34-.34.34-.89 0-1.23L3.54 7.51a.87.87 0 0 0-1.23 0L.43 9.39a.87.87 0 0 0 0 1.23l1.88 1.88c.34.34.89.34 1.23 0zM12 23.57a.87.87 0 0 0 .62-.26l1.88-1.88a.87.87 0 0 0 0-1.23l-1.88-1.88a.87.87 0 0 0-1.23 0l-1.88 1.88a.87.87 0 0 0 0 1.23l1.88 1.88c.17.17.4.26.62.26"/></svg>
                <h1 class="text-xl font-bold text-slate-100">AI 研究伙伴</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="fetch-now-btn" title="根据预设关键词获取最新文章" class="text-slate-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 1-9 9H3.5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h9a9 9 0 0 1 9 9Z"/><path d="M16 12H8"/><path d="m12 16-4-4 4-4"/></svg>
                </button>
                <button id="settings-btn" class="text-slate-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                </button>
            </div>
        </div>
    </header>

    <div class="flex-grow flex overflow-hidden">
        <!-- Left Panel -->
        <aside class="w-1/3 xl:w-1/4 bg-slate-800/50 border-r border-slate-700 flex flex-col">
            <div class="p-4 border-b border-slate-700">
                <div class="relative">
                    <input type="search" id="search-input" placeholder="搜索文章..." class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 pl-10 focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                </div>
            </div>
            <ul id="article-list" class="overflow-y-auto flex-grow">
                <li class="p-4 text-center text-slate-400">正在加载文章列表...</li>
            </ul>
        </aside>

        <!-- Right Panel -->
        <main class="w-2/3 xl:w-3/4 flex flex-col overflow-hidden">
            <div id="detail-placeholder" class="flex items-center justify-center h-full text-center">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-slate-600 mb-4"><path d="m12 3-9 9 9 9 9-9Z"/><path d="M3 12h18"/><path d="m12 3 9 9-9 9-9-9Z"/></svg>
                    <p class="text-slate-500">请从左侧列表选择一篇文章</p>
                </div>
            </div>
            <div id="detail-view" class="hidden flex-grow flex flex-col">
                <!-- Tabs -->
                <div class="flex-shrink-0 border-b border-slate-700 bg-slate-800/50">
                    <div class="px-6">
                        <nav class="flex space-x-6">
                            <button data-tab="summary" class="tab py-3 px-1 border-b-2 border-transparent text-slate-400 hover:text-white font-medium text-sm">智能摘要</button>
                            <button data-tab="detailed" class="tab py-3 px-1 border-b-2 border-transparent text-slate-400 hover:text-white font-medium text-sm">深度解析</button>
                            <button data-tab="qna" class="tab py-3 px-1 border-b-2 border-transparent text-slate-400 hover:text-white font-medium text-sm">论文问答</button>
                        </nav>
                    </div>
                </div>
                <!-- Content -->
                <div id="detail-content" class="flex-grow overflow-y-auto p-6 sm:p-8"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
        <div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl w-full max-w-md">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-slate-100">偏好设置</h3>
                <button id="close-modal-btn" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="font-semibold text-slate-200 block mb-2">研究关键词</label>
                    <div id="keywords-list" class="flex flex-wrap gap-2 mb-2"></div>
                    <div class="flex">
                        <input type="text" id="new-keyword-input" placeholder="新增关键词" class="flex-grow bg-slate-900 border border-slate-600 rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <button id="add-keyword-btn" class="bg-sky-600 text-white font-semibold px-4 rounded-r-md hover:bg-sky-500">新增</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="search-results-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
        <div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl w-full max-w-4xl flex flex-col">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-slate-100">搜索结果</h3>
                <button id="close-search-modal-btn" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="search-results-list" class="p-6 overflow-y-auto modal-content"></div>
            <div class="p-4 border-t border-slate-700 flex justify-end items-center space-x-4">
                <span id="selection-counter" class="text-sm text-slate-400">已选择 0 篇</span>
                <button id="batch-import-btn" class="bg-sky-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-sky-500 disabled:bg-slate-600 disabled:cursor-not-allowed">导入并分析</button>
            </div>
        </div>
    </div>
    
    <script>
    // --- App State ---
    let articlesData = [];
    let currentArticleId = null;
    let currentTab = 'summary';
    const API_BASE_URL = 'http://127.0.0.1:5006';

    // --- DOM Elements ---
    const articleListEl = document.getElementById('article-list');
    const detailPlaceholderEl = document.getElementById('detail-placeholder');
    const detailViewEl = document.getElementById('detail-view');
    const detailContentEl = document.getElementById('detail-content');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModal = document.getElementById('settings-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const keywordsListEl = document.getElementById('keywords-list');
    const newKeywordInput = document.getElementById('new-keyword-input');
    const addKeywordBtn = document.getElementById('add-keyword-btn');
    const searchInput = document.getElementById('search-input');
    const fetchNowBtn = document.getElementById('fetch-now-btn');
    const searchResultsModal = document.getElementById('search-results-modal');
    const closeSearchModalBtn = document.getElementById('close-search-modal-btn');
    const searchResultsList = document.getElementById('search-results-list');
    const selectionCounter = document.getElementById('selection-counter');
    const batchImportBtn = document.getElementById('batch-import-btn');

    // --- API Functions ---
    async function fetchApi(url, options = {}) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        } catch (error) {
            console.error(`Fetch error for ${url}:`, error);
            throw error;
        }
    }

    const api = {
        getKeywords: () => fetchApi(`${API_BASE_URL}/api/keywords`),
        addKeyword: (keyword) => fetchApi(`${API_BASE_URL}/api/keywords`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({keyword})
        }),
        deleteKeyword: (keyword) => fetchApi(`${API_BASE_URL}/api/keywords/${keyword}`, { method: 'DELETE' }),
        getArticles: () => fetchApi(`${API_BASE_URL}/api/articles`),
        getArticleDetails: (id) => fetchApi(`${API_BASE_URL}/api/articles/${id}`),
        postQuestion: (id, question) => fetchApi(`${API_BASE_URL}/api/articles/${id}/ask`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({question})
        }),
        fetchOnDemand: () => fetchApi(`${API_BASE_URL}/api/articles/fetch`, { method: 'POST' }),
        searchArticles: (query) => fetchApi(`${API_BASE_URL}/api/articles/search?query=${encodeURIComponent(query)}`),
        batchImport: (entry_ids) => fetchApi(`${API_BASE_URL}/api/articles/batch-import`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({entry_ids})
        }),
        deleteArticle: (id) => fetchApi(`${API_BASE_URL}/api/articles/${id}`, { method: 'DELETE' }),
        regenerateAnalysis: (id) => fetchApi(`${API_BASE_URL}/api/articles/${id}/regenerate`, { method: 'POST' })
    };

    // --- Render Functions ---
    function renderKeywords(keywords) {
        keywordsListEl.innerHTML = keywords.map(kw => `
            <span class="bg-slate-700 text-slate-200 text-sm px-2 py-1 rounded flex items-center">
                ${kw}
                <button data-keyword="${kw}" class="delete-keyword-btn ml-2 text-slate-400 hover:text-red-400">&times;</button>
            </span>
        `).join('') || '<p class="text-sm text-slate-400">暂无关键词</p>';
    }

    function renderArticleList() {
        if (articlesData.length === 0) {
            articleListEl.innerHTML = '<li class="p-4 text-center text-slate-400">数据库中没有文章。</li>';
            return;
        }
        articleListEl.innerHTML = articlesData.map(article => {
            const summary = article.summary_analysis || {};
            const keywords = (summary.keywords_en || []).slice(0, 2);
            return `
            <li class="article-item p-4 border-b border-slate-700 border-r-4 border-transparent cursor-pointer hover:bg-slate-700/50" data-id="${article.id}">
                <h3 class="font-semibold text-slate-200 truncate">${article.title}</h3>
                <p class="text-sm text-slate-400 mt-1">${article.published}</p>
                <div class="flex flex-wrap gap-1 mt-2">
                    ${keywords.map(kw => `<span class="bg-slate-600 text-slate-300 text-xs px-2 py-0.5 rounded">${kw}</span>`).join('')}
                </div>
            </li>`;
        }).join('');
    }

    async function renderDetailView(id) {
        currentArticleId = id;
        const article = await api.getArticleDetails(id);
        
        detailPlaceholderEl.classList.add('hidden');
        detailViewEl.classList.remove('hidden');

        document.querySelectorAll('.article-item').forEach(item => {
            item.classList.toggle('active', parseInt(item.dataset.id) === id);
        });
        
        renderTabContent(article);
    }

    function renderTabContent(article) {
        let content = '';
        const summary = article.summary_analysis || {};
        const detailed = article.detailed_analysis || {};
        const qnaHistory = article.qna_history || [];

        const actionButtons = `
            <div class="mt-8 pt-6 border-t border-slate-700 flex items-center space-x-4">
                <a href="${article.pdf_url}" target="_blank" class="bg-sky-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-sky-500 text-sm">阅读原文</a>
                <button data-action="regenerate" class="bg-slate-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-slate-500 text-sm">重新生成</button>
                <button data-action="delete" class="bg-red-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-red-500 text-sm">删除文章</button>
            </div>
        `;

        if (currentTab === 'summary') {
            content = `
                <h1 class="text-2xl font-bold text-slate-100 mb-2">${article.title}</h1>
                <p class="text-slate-400 mb-6">${article.authors.join(', ')}</p>
                <div class="bg-slate-800 p-6 rounded-lg border border-slate-700">
                    <p class="text-slate-300 leading-relaxed">${summary.simplified_summary_zh || '无摘要'}</p>
                </div>
                ${actionButtons}
            `;
        } else if (currentTab === 'detailed') {
            content = `
                <h1 class="text-2xl font-bold text-slate-100 mb-6">${article.title}</h1>
                <div class="space-y-6 text-slate-300">
                    <div><h3 class="font-semibold text-lg text-sky-400 mb-2">研究背景</h3><p>${detailed.background || '无'}</p></div>
                    <div><h3 class="font-semibold text-lg text-sky-400 mb-2">使用方法</h3><p>${detailed.methodology || '无'}</p></div>
                    <div><h3 class="font-semibold text-lg text-sky-400 mb-2">核心创新点</h3><ul class="list-disc list-inside space-y-1">${(detailed.key_innovations || []).map(i => `<li>${i}</li>`).join('') || '无'}</ul></div>
                    <div><h3 class="font-semibold text-lg text-sky-400 mb-2">潜在影响</h3><p>${detailed.potential_impact || '无'}</p></div>
                </div>
                ${actionButtons}
            `;
        } else if (currentTab === 'qna') {
            content = `
                <h1 class="text-2xl font-bold text-slate-100 mb-6">论文问答</h1>
                <div id="qna-history" class="mb-4 space-y-4">
                    ${qnaHistory.map(q => `
                        <div class="text-right"><span class="bg-sky-600 text-white p-2 rounded-lg inline-block">${q.question}</span></div>
                        <div><span class="bg-slate-700 text-slate-200 p-2 rounded-lg inline-block">${q.answer}</span></div>
                    `).join('')}
                </div>
                <div class="flex">
                    <input type="text" id="qna-input" placeholder="针对这篇文章提问..." class="flex-grow bg-slate-900 border border-slate-600 rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <button id="qna-submit-btn" class="bg-sky-600 text-white font-semibold px-4 rounded-r-md hover:bg-sky-500">发送</button>
                </div>`;
        }
        detailContentEl.innerHTML = content;
    }
    
    function renderSearchResults(results) {
        if (results.length === 0) {
            searchResultsList.innerHTML = '<p class="text-slate-400 text-center">未找到相关文章。</p>';
            return;
        }
        searchResultsList.innerHTML = results.map(r => `
            <div class="p-4 border-b border-slate-700">
                <div class="flex items-start">
                    <input type="checkbox" data-id="${r.entry_id}" class="mt-1.5 mr-4 bg-slate-900 border-slate-600 text-sky-500 focus:ring-sky-500" ${r.is_imported ? 'disabled' : ''}>
                    <div class="flex-grow">
                        <h4 class="font-semibold text-slate-200">${r.title}</h4>
                        <p class="text-sm text-slate-400 mt-1">${r.authors.join(', ')}</p>
                        <p class="text-sm text-slate-400 mt-2">${r.summary.substring(0, 200)}...</p>
                        ${r.is_imported ? '<span class="text-xs text-green-400 mt-2 inline-block">已导入</span>' : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // --- Event Handlers ---
    async function handleKeywordAdd() {
        const newKeyword = newKeywordInput.value.trim();
        if (newKeyword) {
            await api.addKeyword(newKeyword);
            newKeywordInput.value = '';
            const keywords = await api.getKeywords();
            renderKeywords(keywords);
        }
    }

    async function handleKeywordDelete(e) {
        if (e.target.classList.contains('delete-keyword-btn')) {
            const keyword = e.target.dataset.keyword;
            await api.deleteKeyword(keyword);
            const keywords = await api.getKeywords();
            renderKeywords(keywords);
        }
    }

    async function handleQnaSubmit() {
        const input = document.getElementById('qna-input');
        const question = input.value.trim();
        if (!question || !currentArticleId) return;
        
        const historyEl = document.getElementById('qna-history');
        historyEl.innerHTML += `<div class="text-right"><span class="bg-sky-600 text-white p-2 rounded-lg inline-block">${question}</span></div>`;
        input.value = '';
        input.disabled = true;
        
        await api.postQuestion(currentArticleId, question);
        const article = await api.getArticleDetails(currentArticleId);
        renderTabContent(article);
    }
    
    async function handleSearch(e) {
        if (e.key === 'Enter') {
            const query = searchInput.value.trim();
            if (!query) return;
            searchResultsList.innerHTML = '<p class="text-slate-400 text-center">正在搜索...</p>';
            searchResultsModal.classList.remove('hidden');
            searchResultsModal.classList.add('flex');
            const results = await api.searchArticles(query);
            renderSearchResults(results);
        }
    }

    async function handleBatchImport() {
        const selectedIds = Array.from(searchResultsList.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.dataset.id);
        if (selectedIds.length === 0) return;
        
        batchImportBtn.disabled = true;
        batchImportBtn.textContent = '正在导入...';
        
        await api.batchImport(selectedIds);
        
        searchResultsModal.classList.add('hidden');
        batchImportBtn.disabled = false;
        batchImportBtn.textContent = '导入并分析';
        
        await initialize();
    }

    // --- Initialization ---
    async function initialize() {
        try {
            articlesData = await api.getArticles();
            renderArticleList();
            
            if (articlesData.length > 0) {
                if (!currentArticleId || !articlesData.find(a => a.id === currentArticleId)) {
                    currentArticleId = articlesData[0].id;
                }
                renderDetailView(currentArticleId);
                document.querySelector(`.tab[data-tab="${currentTab}"]`).classList.add('active');
            } else {
                detailViewEl.classList.add('hidden');
                detailPlaceholderEl.classList.remove('hidden');
            }
        } catch (error) {
            console.error("Initialization failed:", error);
            articleListEl.innerHTML = `<li class="p-4 text-center text-red-400">加载失败。请确保后端服务正在运行，并且浏览器可以访问 ${API_BASE_URL}。</li>`;
        }
    }

    // --- Event Listeners Setup ---
    document.addEventListener('DOMContentLoaded', () => {
        settingsBtn.addEventListener('click', async () => {
            const keywords = await api.getKeywords();
            renderKeywords(keywords);
            settingsModal.classList.remove('hidden');
            settingsModal.classList.add('flex');
        });
        closeModalBtn.addEventListener('click', () => settingsModal.classList.add('hidden'));
        addKeywordBtn.addEventListener('click', handleKeywordAdd);
        keywordsListEl.addEventListener('click', handleKeywordDelete);
        
        articleListEl.addEventListener('click', (e) => {
            const item = e.target.closest('.article-item');
            if (item) renderDetailView(parseInt(item.dataset.id));
        });

        detailContentEl.addEventListener('click', async (e) => {
            const action = e.target.dataset.action;
            if (action === 'delete') {
                const articleToDelete = articlesData.find(a => a.id === currentArticleId);
                if (confirm(`确定要删除文章 "${articleToDelete.title}" 吗？`)) {
                    await api.deleteArticle(currentArticleId);
                    currentArticleId = null;
                    await initialize();
                }
            } else if (action === 'regenerate') {
                alert('已开始重新生成分析，请稍后...');
                await api.regenerateAnalysis(currentArticleId);
                renderDetailView(currentArticleId);
            }
        });

        detailViewEl.addEventListener('click', async (e) => {
            if (e.target.matches('.tab')) {
                currentTab = e.target.dataset.tab;
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                if (currentArticleId) {
                    const article = await api.getArticleDetails(currentArticleId);
                    renderTabContent(article);
                }
            }
            if (e.target.id === 'qna-submit-btn') {
                handleQnaSubmit();
            }
        });

        fetchNowBtn.addEventListener('click', async () => {
            alert('已开始在后台获取最新文章，完成后将自动刷新列表。');
            await api.fetchOnDemand();
            await initialize();
        });
        searchInput.addEventListener('keyup', handleSearch);
        closeSearchModalBtn.addEventListener('click', () => searchResultsModal.classList.add('hidden'));
        batchImportBtn.addEventListener('click', handleBatchImport);
        searchResultsList.addEventListener('change', () => {
            const count = searchResultsList.querySelectorAll('input[type="checkbox"]:checked').length;
            selectionCounter.textContent = `已选择 ${count} 篇`;
            batchImportBtn.disabled = count === 0;
        });

        initialize();
    });
    </script>
</body>
</html>
